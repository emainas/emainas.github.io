---
title: 'Sunday Recap'
date: 2025-03-30
permalink: /posts/2025/03/30/sunday-recap/
tags:
  - research recap
  - things I learned
  - comment on sed
  - love for bash and its limits
  - binding thermodynamics
  - do not drink classical water
---

# Sed helps me prepare files for ForceBalance

In my workflows I use [ForceBalance](https://simtk.org/projects/forcebalance) to optimize the force fields of my small molecules. I normally start from gaff2 or sage and then further optimize the bonded parameters as well as the charges (LJ parameters are a different beast and it is better to take the values from a pre-trained and highly tested force field like gaff2). To modify an Amber parameters file for use with ForceBalance, it is best to use [sed](https://www.gnu.org/software/sed/manual/sed.html) and edit the files like this:

```bash 
#!/bin/bash

CountParameters() {
        read -p "Enter name of file: " PARM_FILE
        bond_parms=$(( ($(sed -n '/BOND/,/ANGLE/p' "$PARM_FILE" | wc -l) - 3) * 2 ))
        echo "bond parms is $bond_parms"
        angle_parms=$(( ($(sed -n '/ANGLE/,/DIHE/p' $PARM_FILE | wc -l) - 3) * 2 ))
        echo "ang parms is $angle_parms"
        dih_parms=$(( ($(sed -n '/DIHE/,/IMPROPER/p' $PARM_FILE | wc -l) - 3)))
        echo "dih parms is $dih_parms"
        imp_parms=$(( ($(sed -n '/IMPROPER/,/NONBON/p' $PARM_FILE | wc -l) - 3)))
        echo "improper parms is $imp_parms"
        total=$(($bond_parms + $angle_parms + $dih_parms + $imp_parms))
        echo "total number of parameters is $total"
}

PasteFBKeyword() {
        read -p "Enter name of file: " PARM_FILE
        BOND_KW="# PRM 1 2"
        sed -n '/MASS/,/BOND/p' $PARM_FILE > temp_file.txt
        sed -n '/BOND/,/ANGLE/p' $PARM_FILE | sed "s/$/ $BOND_KW/" >> temp_file.txt
        ANGLE_KW="# PRM 1 2"
        sed -n '/ANGLE/,/DIHE/p' $PARM_FILE | sed "s/$/ $ANGLE_KW/" >> temp_file.txt
        DIH_KW="# PRM 2"
        sed -n '/DIHE/,/IMPROPER/p' $PARM_FILE | sed "s/$/ $DIH_KW/" >> temp_file.txt
        IMP_KW="# PRM 1"
        sed -n '/IMPROPER/,/NONBON/p' $PARM_FILE | sed "s/$/ $IMP_KW/" >> temp_file.txt
        sed -n '/NONBON/,$p' $PARM_FILE >> temp_file.txt
}

CountParameters
PasteFBKeyword
```

One function can count the number of bonded parameters to give an idea of the size of the optimization. The other function adds the FB keywords for parameters to be optimized. The file will need some further editing because the script adds some redundant lines but whatever. 

# Love for bash but there are limits

# Binding thermodynamics

# Do not drink classical water - Marianna Rossi's visit at UNC